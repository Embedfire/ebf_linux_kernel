// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright 2021 EBF
 */

/dts-v1/;

#include <dt-bindings/usb/pd.h>
#include "imx8mm.dtsi"

/ {
        model = "EBF i.MX8MM S1 Board";
        compatible = "ebf,imx8mm-s1", "fsl,imx8mm";

        reserved-memory {
                #address-cells = <2>;
                #size-cells = <2>;
                ranges;

                rpmsg_reserved: rpmsg@0xb8000000 {
                        no-map;
                        reg = <0 0xb8000000 0 0x400000>;
                };
        };

        chosen {
                stdout-path = &uart2;
        };

        leds {
                compatible = "gpio-leds";
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_gpio_led>;

                led0: cpu {
                        label = "cpu";
                        gpios = <&gpio3 16 GPIO_ACTIVE_HIGH>;
			default-state = "on";
                       	linux,default-trigger = "heartbeat"; 
                };
        };

        reg_usdhc2_vmmc: regulator-usdhc2 {
                compatible = "regulator-fixed";
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_reg_usdhc2_vmmc>;
                regulator-name = "VSD_3V3";
                regulator-min-microvolt = <3300000>;
                regulator-max-microvolt = <3300000>;
                gpio = <&gpio2 19 GPIO_ACTIVE_HIGH>;
                off-on-delay-us = <20000>;
                enable-active-high;
        };

        reg_otg_vbus: regulator-otg-vbus {
                compatible = "regulator-fixed";
                pinctrl-names = "default";
                pinctrl-0 = <&pinctrl_reg_otg_vbus>;
                enable-active-high;
                regulator-min-microvolt = <5000000>;
                regulator-max-microvolt = <5000000>;
                gpio = <&gpio1 15 GPIO_ACTIVE_HIGH>;
                regulator-name = "otg_vbus";
        };
};

&A53_0 {
        cpu-supply = <&buck2_reg>;
};

&fec1 {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_fec1>;
        phy-mode = "rgmii-id";
        phy-handle = <&ethphy0>;
        phy-reset-gpios = <&gpio4 22 GPIO_ACTIVE_LOW>;
        phy-reset-post-delay = <150>;
        phy-reset-duration = <10>;
        fsl,magic-packet;
        status = "okay";

        mdio {
                #address-cells = <1>;
                #size-cells = <0>;

                ethphy0: ethernet-phy@0 {
                        /* Realtek RTL8211F (0x001cc916) */
                        compatible = "ethernet-phy-ieee802.3-c22";
                        reg = <0>;
                };
        };
};

&snvs_pwrkey {
        status = "okay";
};

&uart2 { /* console */
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_uart2>;
        status = "okay";
};

&usbotg1 {
        dr_mode = "otg";
        srp-disable;
        hnp-disable;
        adp-disable;
	vbus-supply = <&reg_otg_vbus>;
        status = "okay";
};

&usbotg2 {
        dr_mode = "host";
        disable-over-current;
        status = "okay";
};

&usdhc2 { /* SD Card */
        pinctrl-names = "default", "state_100mhz", "state_200mhz";
        pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
        pinctrl-1 = <&pinctrl_usdhc2_100mhz>, <&pinctrl_usdhc2_gpio>;
        pinctrl-2 = <&pinctrl_usdhc2_200mhz>, <&pinctrl_usdhc2_gpio>;
        cd-gpios = <&gpio2 12 GPIO_ACTIVE_LOW>;
        bus-width = <4>;
        vmmc-supply = <&reg_usdhc2_vmmc>;
        status = "okay";
};

&usdhc3 { /* eMMC */
        pinctrl-names = "default", "state_100mhz", "state_200mhz";
        pinctrl-0 = <&pinctrl_usdhc3>;
        pinctrl-1 = <&pinctrl_usdhc3_100mhz>;
        pinctrl-2 = <&pinctrl_usdhc3_200mhz>;
        bus-width = <8>;
        max-frequency = <200000000>;
        non-removable;
        status = "okay";
};

&wdog1 {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_wdog>;
        fsl,ext-reset-output;
        status = "okay";
};

&vpu_g1 {
        status = "okay";
};

&vpu_g2 {
        status = "okay";
};

&vpu_h1 {
        status = "okay";
};

&gpu {
        status = "okay";
};

&i2c1 {
        clock-frequency = <400000>;
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_i2c1>;
        status = "okay";

        pmic: pca9450@25 {
                reg = <0x25>;
                compatible = "nxp,pca9450";
                /* PMIC PCA9450 PMIC_nINT GPIO1_IO3 */
                pinctrl-0 = <&pinctrl_pmic_int>;
                gpio_intr = <&gpio1 3 GPIO_ACTIVE_LOW>;

                regulators {
                        #address-cells = <1>;
                        #size-cells = <0>;

                        pca9450,pmic-buck2-uses-i2c-dvs;
                        /* Run/Standby voltage */
                        pca9450,pmic-buck2-dvs-voltage = <950000>, <850000>;

                        buck1_reg: regulator@0 {
                                reg = <0>;
                                regulator-compatible = "buck1";
                                regulator-min-microvolt = <600000>;
                                regulator-max-microvolt = <2187500>;
                                regulator-boot-on;
                                regulator-always-on;
                                regulator-ramp-delay = <3125>;
                        };

                        buck2_reg: regulator@1 {
                                reg = <1>;
                                regulator-compatible = "buck2";
                                regulator-min-microvolt = <600000>;
                                regulator-max-microvolt = <2187500>;
                                regulator-boot-on;
                                regulator-always-on;
                                regulator-ramp-delay = <3125>;
                        };

                        buck3_reg: regulator@2 {
                                reg = <2>;
                                regulator-compatible = "buck3";
                                regulator-min-microvolt = <600000>;
                                regulator-max-microvolt = <2187500>;
                                regulator-boot-on;
                                regulator-always-on;
                        };

                        buck4_reg: regulator@3 {
                                reg = <3>;
                                regulator-compatible = "buck4";
                                regulator-min-microvolt = <600000>;
                                regulator-max-microvolt = <3400000>;
                                regulator-boot-on;
                                regulator-always-on;
                        };

                        buck5_reg: regulator@4 {
                                reg = <4>;
                                regulator-compatible = "buck5";
                                regulator-min-microvolt = <600000>;
                                regulator-max-microvolt = <3400000>;
                                regulator-boot-on;
                                regulator-always-on;
                        };

                        buck6_reg: regulator@5 {
                                reg = <5>;
                                regulator-compatible = "buck6";
                                regulator-min-microvolt = <600000>;
                                regulator-max-microvolt = <3400000>;
                                regulator-boot-on;
                                regulator-always-on;
                        };

                        ldo1_reg: regulator@6 {
                                reg = <6>;
                                regulator-compatible = "ldo1";
                                regulator-min-microvolt = <1600000>;
                                regulator-max-microvolt = <3300000>;
                                regulator-boot-on;
                                regulator-always-on;
                        };

                        ldo2_reg: regulator@7 {
                                reg = <7>;
                                regulator-compatible = "ldo2";
                                regulator-min-microvolt = <800000>;
                                regulator-max-microvolt = <1150000>;
                                regulator-boot-on;
                                regulator-always-on;
                        };

                        ldo3_reg: regulator@8 {
                                reg = <8>;
                                regulator-compatible = "ldo3";
                                regulator-min-microvolt = <800000>;
                                regulator-max-microvolt = <3300000>;
                                regulator-boot-on;
                                regulator-always-on;
                        };

                        ldo4_reg: regulator@9 {
                                reg = <9>;
                                regulator-compatible = "ldo4";
                                regulator-min-microvolt = <800000>;
                                regulator-max-microvolt = <3300000>;
                                regulator-boot-on;
                                regulator-always-on;
                        };

                        ldo5_reg: regulator@10 {
                                reg = <10>;
                                regulator-compatible = "ldo5";
                                regulator-min-microvolt = <1800000>;
                                regulator-max-microvolt = <3300000>;
                        };
                };
        };
};

&iomuxc {
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_hog_1>;

        pinctrl_hog_1: hoggrp-1 {
        fsl,pins = <
                MX8MM_IOMUXC_GPIO1_IO11_GPIO1_IO11		0x19
                >;
        };

        pinctrl_gpio_led: gpioledgrp {
                fsl,pins = <
                        MX8MM_IOMUXC_NAND_READY_B_GPIO3_IO16    0x19
                >;
        };

        pinctrl_reg_otg_vbus: regotgvbusgrp {
                fsl,pins = <
                        MX8MM_IOMUXC_GPIO1_IO15_GPIO1_IO15      0x41
                >;
        };

        pinctrl_uart2: uart2grp {
                fsl,pins = <
                        MX8MM_IOMUXC_UART2_RXD_UART2_DCE_RX     0x140
                        MX8MM_IOMUXC_UART2_TXD_UART2_DCE_TX     0x140
                >;
        };

        pinctrl_pmic_int: pmicintgrp {
                fsl,pins = <
                        MX8MM_IOMUXC_GPIO1_IO03_GPIO1_IO3               0x41
                >;
        };
	
        pinctrl_i2c1: i2c1grp {
                fsl,pins = <
                        MX8MM_IOMUXC_I2C1_SCL_I2C1_SCL                  0x400001c3
                        MX8MM_IOMUXC_I2C1_SDA_I2C1_SDA                  0x400001c3
                >;
        };

        pinctrl_fec1: fec1grp {
                fsl,pins = <
                        MX8MM_IOMUXC_ENET_MDC_ENET1_MDC                 0x3
                        MX8MM_IOMUXC_ENET_MDIO_ENET1_MDIO               0x3
                        MX8MM_IOMUXC_ENET_TD3_ENET1_RGMII_TD3           0x1f
                        MX8MM_IOMUXC_ENET_TD2_ENET1_RGMII_TD2           0x1f
                        MX8MM_IOMUXC_ENET_TD1_ENET1_RGMII_TD1           0x1f
                        MX8MM_IOMUXC_ENET_TD0_ENET1_RGMII_TD0           0x1f
                        MX8MM_IOMUXC_ENET_RD3_ENET1_RGMII_RD3           0x91
                        MX8MM_IOMUXC_ENET_RD2_ENET1_RGMII_RD2           0x91
                        MX8MM_IOMUXC_ENET_RD1_ENET1_RGMII_RD1           0x91
                        MX8MM_IOMUXC_ENET_RD0_ENET1_RGMII_RD0           0x91
                        MX8MM_IOMUXC_ENET_TXC_ENET1_RGMII_TXC           0x1f
                        MX8MM_IOMUXC_ENET_RXC_ENET1_RGMII_RXC           0x91
                        MX8MM_IOMUXC_ENET_RX_CTL_ENET1_RGMII_RX_CTL     0x91
                        MX8MM_IOMUXC_ENET_TX_CTL_ENET1_RGMII_TX_CTL     0x1f
                        MX8MM_IOMUXC_SAI2_RXC_GPIO4_IO22                0x19
                >;
        };

        pinctrl_reg_usdhc2_vmmc: regusdhc2vmmc {
                fsl,pins = <
                        MX8MM_IOMUXC_SD2_RESET_B_GPIO2_IO19     0x41
                >;
        };

        pinctrl_usdhc2_gpio: usdhc2grpgpio {
                fsl,pins = <
                	MX8MM_IOMUXC_SD2_CD_B_GPIO2_IO12        0x1c4 
                >;
        };

        pinctrl_usdhc2: usdhc2grp {
                fsl,pins = <
                        MX8MM_IOMUXC_SD2_CLK_USDHC2_CLK         0x190
                        MX8MM_IOMUXC_SD2_CMD_USDHC2_CMD         0x1d0
                        MX8MM_IOMUXC_SD2_DATA0_USDHC2_DATA0     0x1d0
                        MX8MM_IOMUXC_SD2_DATA1_USDHC2_DATA1     0x1d0
                        MX8MM_IOMUXC_SD2_DATA2_USDHC2_DATA2     0x1d0
                        MX8MM_IOMUXC_SD2_DATA3_USDHC2_DATA3     0x1d0
                        MX8MM_IOMUXC_GPIO1_IO04_USDHC2_VSELECT  0x1d0
                >;
        };

        pinctrl_usdhc2_100mhz: usdhc2grp100mhz {
                fsl,pins = <
                        MX8MM_IOMUXC_SD2_CLK_USDHC2_CLK         0x194
                        MX8MM_IOMUXC_SD2_CMD_USDHC2_CMD         0x1d4
                        MX8MM_IOMUXC_SD2_DATA0_USDHC2_DATA0     0x1d4
                        MX8MM_IOMUXC_SD2_DATA1_USDHC2_DATA1     0x1d4
                        MX8MM_IOMUXC_SD2_DATA2_USDHC2_DATA2     0x1d4
                        MX8MM_IOMUXC_SD2_DATA3_USDHC2_DATA3     0x1d4
                        MX8MM_IOMUXC_GPIO1_IO04_USDHC2_VSELECT  0x1d0
                >;
        };

        pinctrl_usdhc2_200mhz: usdhc2grp200mhz {
                fsl,pins = <
                        MX8MM_IOMUXC_SD2_CLK_USDHC2_CLK         0x196
                        MX8MM_IOMUXC_SD2_CMD_USDHC2_CMD         0x1d6
                        MX8MM_IOMUXC_SD2_DATA0_USDHC2_DATA0     0x1d6
                        MX8MM_IOMUXC_SD2_DATA1_USDHC2_DATA1     0x1d6
                        MX8MM_IOMUXC_SD2_DATA2_USDHC2_DATA2     0x1d6
                        MX8MM_IOMUXC_SD2_DATA3_USDHC2_DATA3     0x1d6
                        MX8MM_IOMUXC_GPIO1_IO04_USDHC2_VSELECT  0x1d0
                >;
        };

        pinctrl_usdhc3: usdhc3grp {
                fsl,pins = <
                        MX8MM_IOMUXC_NAND_WE_B_USDHC3_CLK               0x190
                        MX8MM_IOMUXC_NAND_WP_B_USDHC3_CMD               0x1d0
                        MX8MM_IOMUXC_NAND_DATA04_USDHC3_DATA0           0x1d0
                        MX8MM_IOMUXC_NAND_DATA05_USDHC3_DATA1           0x1d0
                        MX8MM_IOMUXC_NAND_DATA06_USDHC3_DATA2           0x1d0
                        MX8MM_IOMUXC_NAND_DATA07_USDHC3_DATA3           0x1d0
                        MX8MM_IOMUXC_NAND_RE_B_USDHC3_DATA4             0x1d0
                        MX8MM_IOMUXC_NAND_CE2_B_USDHC3_DATA5            0x1d0
                        MX8MM_IOMUXC_NAND_CE3_B_USDHC3_DATA6            0x1d0
                        MX8MM_IOMUXC_NAND_CLE_USDHC3_DATA7              0x1d0
                        MX8MM_IOMUXC_NAND_CE1_B_USDHC3_STROBE           0x190
                >;
        };

        pinctrl_usdhc3_100mhz: usdhc3grp100mhz {
                fsl,pins = <
                        MX8MM_IOMUXC_NAND_WE_B_USDHC3_CLK               0x194
                        MX8MM_IOMUXC_NAND_WP_B_USDHC3_CMD               0x1d4
                        MX8MM_IOMUXC_NAND_DATA04_USDHC3_DATA0           0x1d4
                        MX8MM_IOMUXC_NAND_DATA05_USDHC3_DATA1           0x1d4
                        MX8MM_IOMUXC_NAND_DATA06_USDHC3_DATA2           0x1d4
                        MX8MM_IOMUXC_NAND_DATA07_USDHC3_DATA3           0x1d4
                        MX8MM_IOMUXC_NAND_RE_B_USDHC3_DATA4             0x1d4
                        MX8MM_IOMUXC_NAND_CE2_B_USDHC3_DATA5            0x1d4
                        MX8MM_IOMUXC_NAND_CE3_B_USDHC3_DATA6            0x1d4
                        MX8MM_IOMUXC_NAND_CLE_USDHC3_DATA7              0x1d4
                        MX8MM_IOMUXC_NAND_CE1_B_USDHC3_STROBE           0x194
                >;
        };

        pinctrl_usdhc3_200mhz: usdhc3grp200mhz {
                fsl,pins = <
                        MX8MM_IOMUXC_NAND_WE_B_USDHC3_CLK               0x196
                        MX8MM_IOMUXC_NAND_WP_B_USDHC3_CMD               0x1d6
                        MX8MM_IOMUXC_NAND_DATA04_USDHC3_DATA0           0x1d6
                        MX8MM_IOMUXC_NAND_DATA05_USDHC3_DATA1           0x1d6
                        MX8MM_IOMUXC_NAND_DATA06_USDHC3_DATA2           0x1d6
                        MX8MM_IOMUXC_NAND_DATA07_USDHC3_DATA3           0x1d6
                        MX8MM_IOMUXC_NAND_RE_B_USDHC3_DATA4             0x1d6
                        MX8MM_IOMUXC_NAND_CE2_B_USDHC3_DATA5            0x1d6
                        MX8MM_IOMUXC_NAND_CE3_B_USDHC3_DATA6            0x1d6
                        MX8MM_IOMUXC_NAND_CLE_USDHC3_DATA7              0x1d6
                        MX8MM_IOMUXC_NAND_CE1_B_USDHC3_STROBE           0x196
                >;
        };

        pinctrl_wdog: wdoggrp {
                fsl,pins = <
                        MX8MM_IOMUXC_GPIO1_IO02_WDOG1_WDOG_B    0xc6
                >;
        };
};

